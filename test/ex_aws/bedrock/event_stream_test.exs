defmodule ExAws.Bedrock.EventStreamTest do
  use ExUnit.Case

  alias ExAws.Bedrock.EventStream

  describe "decode_chunk/1" do
    test "good", %{chunk: chunk} do
      assert {:chunk, %{"outputText" => output_text}} = EventStream.decode_chunk(chunk)
      assert String.contains?(output_text, "Elixir")
    end
  end

  setup_all do
    chunk =
      <<0, 0, 2, 211, 0, 0, 0, 75, 7, 177, 227, 243, 11, 58, 101, 118, 101, 110, 116, 45, 116,
        121, 112, 101, 7, 0, 5, 99, 104, 117, 110, 107, 13, 58, 99, 111, 110, 116, 101, 110, 116,
        45, 116, 121, 112, 101, 7, 0, 16, 97, 112, 112, 108, 105, 99, 97, 116, 105, 111, 110, 47,
        106, 115, 111, 110, 13, 58, 109, 101, 115, 115, 97, 103, 101, 45, 116, 121, 112, 101, 7,
        0, 5, 101, 118, 101, 110, 116, 123, 34, 98, 121, 116, 101, 115, 34, 58, 34, 101, 121, 74,
        118, 100, 88, 82, 119, 100, 88, 82, 85, 90, 88, 104, 48, 73, 106, 111, 105, 88, 71, 53,
        70, 98, 71, 108, 52, 97, 88, 73, 103, 97, 88, 77, 103, 89, 83, 66, 119, 99, 109, 57, 110,
        99, 109, 70, 116, 98, 87, 108, 117, 90, 121, 66, 115, 89, 87, 53, 110, 100, 87, 70, 110,
        90, 83, 66, 48, 97, 71, 70, 48, 73, 71, 70, 112, 98, 88, 77, 103, 100, 71, 56, 103, 97,
        87, 49, 119, 99, 109, 57, 50, 90, 83, 66, 48, 97, 71, 85, 103, 99, 72, 74, 118, 90, 72,
        86, 106, 100, 71, 108, 50, 97, 88, 82, 53, 73, 71, 70, 117, 90, 67, 66, 122, 89, 50, 70,
        115, 89, 87, 74, 112, 98, 71, 108, 48, 101, 83, 66, 118, 90, 105, 66, 122, 98, 50, 90, 48,
        100, 50, 70, 121, 90, 83, 66, 107, 90, 88, 90, 108, 98, 71, 57, 119, 98, 87, 86, 117, 100,
        67, 66, 105, 101, 83, 66, 119, 99, 109, 57, 50, 97, 87, 82, 112, 98, 109, 99, 103, 89, 83,
        66, 106, 98, 50, 53, 106, 97, 88, 78, 108, 73, 71, 70, 117, 90, 67, 66, 108, 101, 72, 66,
        121, 90, 88, 78, 122, 97, 88, 90, 108, 73, 72, 78, 53, 98, 110, 82, 104, 101, 67, 119,
        103, 99, 71, 57, 51, 90, 88, 74, 109, 100, 87, 119, 103, 90, 109, 86, 104, 100, 72, 86,
        121, 90, 88, 77, 115, 73, 71, 70, 117, 90, 67, 66, 104, 73, 72, 74, 118, 89, 110, 86, 122,
        100, 67, 66, 108, 89, 50, 57, 122, 101, 88, 78, 48, 90, 87, 48, 103, 98, 50, 89, 103, 98,
        71, 108, 105, 99, 109, 70, 121, 97, 87, 86, 122, 73, 71, 70, 117, 90, 67, 66, 48, 98, 50,
        57, 115, 99, 121, 52, 105, 76, 67, 74, 112, 98, 109, 82, 108, 101, 67, 73, 54, 77, 67,
        119, 105, 100, 71, 57, 48, 89, 87, 120, 80, 100, 88, 82, 119, 100, 88, 82, 85, 90, 88,
        104, 48, 86, 71, 57, 114, 90, 87, 53, 68, 98, 51, 86, 117, 100, 67, 73, 54, 78, 68, 65,
        115, 73, 109, 78, 118, 98, 88, 66, 115, 90, 88, 82, 112, 98, 50, 53, 83, 90, 87, 70, 122,
        98, 50, 52, 105, 79, 105, 74, 71, 83, 85, 53, 74, 85, 48, 103, 105, 76, 67, 74, 112, 98,
        110, 66, 49, 100, 70, 82, 108, 101, 72, 82, 85, 98, 50, 116, 108, 98, 107, 78, 118, 100,
        87, 53, 48, 73, 106, 111, 120, 77, 83, 119, 105, 89, 87, 49, 104, 101, 109, 57, 117, 76,
        87, 74, 108, 90, 72, 74, 118, 89, 50, 115, 116, 97, 87, 53, 50, 98, 50, 78, 104, 100, 71,
        108, 118, 98, 107, 49, 108, 100, 72, 74, 112, 89, 51, 77, 105, 79, 110, 115, 105, 97, 87,
        53, 119, 100, 88, 82, 85, 98, 50, 116, 108, 98, 107, 78, 118, 100, 87, 53, 48, 73, 106,
        111, 120, 77, 83, 119, 105, 98, 51, 86, 48, 99, 72, 86, 48, 86, 71, 57, 114, 90, 87, 53,
        68, 98, 51, 86, 117, 100, 67, 73, 54, 78, 68, 65, 115, 73, 109, 108, 117, 100, 109, 57,
        106, 89, 88, 82, 112, 98, 50, 53, 77, 89, 88, 82, 108, 98, 109, 78, 53, 73, 106, 111, 120,
        78, 106, 103, 49, 76, 67, 74, 109, 97, 88, 74, 122, 100, 69, 74, 53, 100, 71, 86, 77, 89,
        88, 82, 108, 98, 109, 78, 53, 73, 106, 111, 120, 78, 106, 103, 49, 102, 88, 48, 61, 34,
        125, 72, 100, 27, 122>>

    [chunk: chunk]
  end
end
